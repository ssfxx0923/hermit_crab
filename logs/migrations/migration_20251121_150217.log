[2025-11-21 15:02:17] [INFO] ============================================================
[2025-11-21 15:02:17] [INFO] 开始执行迁移流程
[2025-11-21 15:02:17] [INFO] 迁移日志: /root/hermit_crab/logs/migrations/migration_20251121_150217.log
[2025-11-21 15:02:17] [INFO] ============================================================
[2025-11-21 15:02:17] [INFO] 剩余时间 14 天，暂不需要迁移
[2025-11-21 15:02:17] [INFO] 当前服务器IP: 170.64.226.135
[2025-11-21 15:02:17] [INFO] 当前服务器剩余: 14 天
[2025-11-21 15:02:17] [WARNING] ⚠️  强制迁移模式：忽略生命周期检查
[2025-11-21 15:02:17] [INFO] 从GitHub同步服务器列表...
[2025-11-21 15:02:17] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:02:18] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:02:18] [INFO] 服务器列表已保存
[2025-11-21 15:02:18] [INFO] 自动选择目标服务器...
[2025-11-21 15:02:18] [INFO] 找到 1 个可用服务器
[2025-11-21 15:02:18] [INFO] ✅ 选择剩余时间最长的服务器: 159.65.104.203 (剩余 14 天)
[2025-11-21 15:02:18] [INFO] 目标服务器IP: 159.65.104.203
[2025-11-21 15:02:18] [INFO] 目标剩余时间: 14 天
[2025-11-21 15:02:18] [INFO] ✅ 已从环境变量获取SSH密码
[2025-11-21 15:02:18] [INFO] 尝试获取服务器锁: 159.65.104.203
[2025-11-21 15:02:18] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:02:18] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:02:18] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:02:20] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:02:20] [INFO] ✅ 成功获取服务器锁: 159.65.104.203
[2025-11-21 15:02:20] [INFO] 迁移开始时间: 2025-11-21 15:02:20
[2025-11-21 15:02:20] [INFO] ============================================================
[2025-11-21 15:02:20] [INFO] 开始迁移到目标服务器: 159.65.104.203
[2025-11-21 15:02:20] [INFO] ============================================================
[2025-11-21 15:02:20] [INFO] 测试SSH连接: 159.65.104.203
[2025-11-21 15:02:22] [INFO] SSH连接测试成功
[2025-11-21 15:02:22] [INFO] 配置SSH密钥到 159.65.104.203
[2025-11-21 15:02:27] [INFO] SSH密钥配置成功
[2025-11-21 15:02:27] [INFO] 在目标服务器备份关键文件...
[2025-11-21 15:02:37] [INFO] 关键文件备份完成
[2025-11-21 15:02:37] [INFO] ============================================================
[2025-11-21 15:02:37] [INFO] 开始Rsync系统文件同步...
[2025-11-21 15:02:37] [INFO] ============================================================
[2025-11-21 15:02:37] [INFO] 执行命令: rsync -aAXvzP --delete --numeric-ids --exclude-from=/root/hermit_crab/config/exclude_list.txt -e "ssh -i /root/.ssh/hermit_crab_id_rsa -o StrictHostKeyChecking=no" / root@159.65.104.203:/
[2025-11-21 15:02:37] [INFO] Rsync 传输中，实时进度显示：
[2025-11-21 15:02:37] [INFO] ------------------------------------------------------------
[2025-11-21 15:05:20] [INFO] ------------------------------------------------------------
[2025-11-21 15:05:20] [INFO] 传输统计: 共处理 240413 个文件/目录
[2025-11-21 15:05:20] [INFO] ✅ Rsync同步完成 (耗时: 163.19秒)
[2025-11-21 15:05:20] [INFO] 恢复目标服务器网络配置...
[2025-11-21 15:05:29] [INFO] 网络配置恢复完成
[2025-11-21 15:05:29] [INFO] ============================================================
[2025-11-21 15:05:29] [INFO] ✅ 迁移完成！
[2025-11-21 15:05:29] [INFO] ============================================================
[2025-11-21 15:05:29] [INFO] ============================================================
[2025-11-21 15:05:29] [INFO] 开始初始化目标服务器
[2025-11-21 15:05:29] [INFO] ============================================================
[2025-11-21 15:05:29] [INFO] 同步配置文件到目标服务器...
[2025-11-21 15:05:33] [INFO] ✅ 已同步: /root/hermit_crab/.env
[2025-11-21 15:05:36] [INFO] ✅ 已同步: /root/hermit_crab/data/nodes.json
[2025-11-21 15:05:36] [INFO] 清理 Python 字节码缓存...
[2025-11-21 15:05:44] [INFO] ✅ Python 缓存清理完成
[2025-11-21 15:05:44] [INFO] 检查目标服务器 Python 环境...
[2025-11-21 15:05:46] [WARNING] ⚠️  pip 损坏，正在修复...
[2025-11-21 15:05:51] [ERROR] ❌ 修复失败: error: externally-managed-environment

× This environment is externally managed
╰─> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    If you wish to install a non-Debian packaged Python application,
    it may be easiest to use pipx install xyz, which will manage a
    virtual environment for you. Make sure you have pipx installed.
    
    See /usr/share/doc/python3.13/README.venv for more information.

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.

[2025-11-21 15:05:51] [ERROR] ❌ 目标服务器初始化失败
[2025-11-21 15:05:51] [WARNING] ⚠️  迁移主体完成但初始化失败，需要手动完成初始化
[2025-11-21 15:05:51] [INFO] 更新DNS: a -> 159.65.104.203
[2025-11-21 15:05:51] [INFO] 更新域名解析: a.ssfxx.com -> 159.65.104.203
[2025-11-21 15:05:51] [INFO] 找到DNS记录: a.ssfxx.com -> 159.65.104.203
[2025-11-21 15:05:51] [INFO] DNS记录IP未变化: 159.65.104.203
[2025-11-21 15:05:51] [INFO] ✅ DNS已更新
[2025-11-21 15:05:51] [INFO] 更新服务器状态...
[2025-11-21 15:05:51] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:05:52] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:05:52] [INFO] 服务器 159.65.104.203 状态已更新: active
[2025-11-21 15:05:52] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:05:54] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:05:54] [INFO] 删除源服务器: 170.64.226.135
[2025-11-21 15:05:54] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:05:54] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:05:54] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:05:56] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:05:56] [INFO] 迁移记录已添加: 159.65.104.203
[2025-11-21 15:05:56] [INFO] ============================================================
[2025-11-21 15:05:56] [INFO] 🎉 迁移流程全部完成！
[2025-11-21 15:05:56] [INFO] ============================================================
[2025-11-21 15:05:56] [INFO] 源服务器IP: 170.64.226.135
[2025-11-21 15:05:56] [INFO] 目标服务器IP: 159.65.104.203
[2025-11-21 15:05:56] [INFO] 迁移开始时间: 2025-11-21 15:02:20
[2025-11-21 15:05:56] [INFO] 迁移结束时间: 2025-11-21 15:05:56
[2025-11-21 15:05:56] [INFO] 总耗时: 215.99秒 (3.6分钟)
[2025-11-21 15:05:56] [INFO] 迁移日志已保存: /root/hermit_crab/logs/migrations/migration_20251121_150217.log
[2025-11-21 15:05:56] [INFO] ============================================================
