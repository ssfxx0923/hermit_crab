[2025-11-21 15:43:45] [INFO] ============================================================
[2025-11-21 15:43:45] [INFO] 开始执行迁移流程
[2025-11-21 15:43:45] [INFO] 迁移日志: /root/hermit_crab/logs/migrations/migration_20251121_154345.log
[2025-11-21 15:43:45] [INFO] ============================================================
[2025-11-21 15:43:45] [INFO] 剩余时间 14 天，暂不需要迁移
[2025-11-21 15:43:45] [INFO] 当前服务器IP: 170.64.226.135
[2025-11-21 15:43:45] [INFO] 当前服务器剩余: 14 天
[2025-11-21 15:43:45] [WARNING] ⚠️  强制迁移模式：忽略生命周期检查
[2025-11-21 15:43:45] [INFO] 从GitHub同步服务器列表...
[2025-11-21 15:43:45] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:43:46] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:43:46] [INFO] 服务器列表已保存
[2025-11-21 15:43:46] [INFO] 自动选择目标服务器...
[2025-11-21 15:43:46] [INFO] 找到 1 个可用服务器
[2025-11-21 15:43:46] [INFO] ✅ 选择剩余时间最长的服务器: 104.248.191.16 (剩余 14 天)
[2025-11-21 15:43:46] [INFO] 目标服务器IP: 104.248.191.16
[2025-11-21 15:43:46] [INFO] 目标剩余时间: 14 天
[2025-11-21 15:43:46] [INFO] ✅ 已从环境变量获取SSH密码
[2025-11-21 15:43:46] [INFO] 尝试获取服务器锁: 104.248.191.16
[2025-11-21 15:43:46] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:43:46] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:43:46] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:43:48] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:43:48] [INFO] ✅ 成功获取服务器锁: 104.248.191.16
[2025-11-21 15:43:48] [INFO] 迁移开始时间: 2025-11-21 15:43:48
[2025-11-21 15:43:48] [INFO] ============================================================
[2025-11-21 15:43:48] [INFO] 开始迁移到目标服务器: 104.248.191.16
[2025-11-21 15:43:48] [INFO] ============================================================
[2025-11-21 15:43:48] [INFO] 测试SSH连接: 104.248.191.16
[2025-11-21 15:43:51] [INFO] SSH连接测试成功
[2025-11-21 15:43:51] [INFO] 配置SSH密钥到 104.248.191.16
[2025-11-21 15:43:55] [INFO] SSH密钥配置成功
[2025-11-21 15:43:55] [INFO] 在目标服务器备份关键文件...
[2025-11-21 15:44:05] [INFO] 关键文件备份完成
[2025-11-21 15:44:05] [INFO] ============================================================
[2025-11-21 15:44:05] [INFO] 开始Rsync系统文件同步...
[2025-11-21 15:44:05] [INFO] ============================================================
[2025-11-21 15:44:05] [INFO] 执行命令: rsync -aAXvzP --delete --numeric-ids --exclude-from=/root/hermit_crab/config/exclude_list.txt -e "ssh -i /root/.ssh/hermit_crab_id_rsa -o StrictHostKeyChecking=no" / root@104.248.191.16:/
[2025-11-21 15:44:05] [INFO] Rsync 传输中，实时进度显示：
[2025-11-21 15:44:05] [INFO] ------------------------------------------------------------
[2025-11-21 15:47:11] [INFO] ------------------------------------------------------------
[2025-11-21 15:47:11] [INFO] 传输统计: 共处理 246951 个文件/目录
[2025-11-21 15:47:11] [INFO] ✅ Rsync同步完成 (耗时: 186.15秒)
[2025-11-21 15:47:11] [INFO] 恢复目标服务器网络配置...
[2025-11-21 15:48:21] [INFO] 网络配置恢复完成
[2025-11-21 15:48:21] [INFO] ============================================================
[2025-11-21 15:48:21] [INFO] ✅ 迁移完成！
[2025-11-21 15:48:21] [INFO] ============================================================
[2025-11-21 15:48:21] [INFO] ============================================================
[2025-11-21 15:48:21] [INFO] 开始初始化目标服务器
[2025-11-21 15:48:21] [INFO] ============================================================
[2025-11-21 15:48:21] [INFO] 同步配置文件到目标服务器...
[2025-11-21 15:48:44] [INFO] ✅ 已同步: /root/hermit_crab/.env
[2025-11-21 15:48:55] [INFO] ✅ 已同步: /root/hermit_crab/data/nodes.json
[2025-11-21 15:48:55] [INFO] 清理 Python 字节码缓存...
[2025-11-21 15:49:42] [INFO] ✅ Python 缓存清理完成
[2025-11-21 15:49:42] [INFO] 更新目标服务器生命周期信息...
[2025-11-21 15:51:51] [ERROR] ❌ 更新生命周期失败: Connection closed by 104.248.191.16 port 22

[2025-11-21 15:51:51] [ERROR] ❌ 目标服务器初始化失败
[2025-11-21 15:51:51] [WARNING] ⚠️  迁移主体完成但初始化失败，需要手动完成初始化
[2025-11-21 15:51:51] [INFO] 更新DNS: a -> 104.248.191.16
[2025-11-21 15:51:51] [INFO] 更新域名解析: a.ssfxx.com -> 104.248.191.16
[2025-11-21 15:51:52] [INFO] 找到DNS记录: a.ssfxx.com -> 159.65.104.203
[2025-11-21 15:51:52] [INFO] ✅ DNS记录已更新: a.ssfxx.com 159.65.104.203 -> 104.248.191.16
[2025-11-21 15:51:52] [INFO] ✅ DNS已更新
[2025-11-21 15:51:52] [INFO] 更新服务器状态...
[2025-11-21 15:51:52] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:51:53] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:51:53] [INFO] 服务器 104.248.191.16 状态已更新: active
[2025-11-21 15:51:53] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:51:54] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:51:54] [INFO] 删除源服务器: 170.64.226.135
[2025-11-21 15:51:54] [INFO] 从GitHub拉取: nodes.json
[2025-11-21 15:51:55] [INFO] ✅ 成功拉取服务器列表 (1 个服务器)
[2025-11-21 15:51:55] [INFO] 推送服务器列表到GitHub...
[2025-11-21 15:51:56] [INFO] ✅ 服务器列表已更新到GitHub
[2025-11-21 15:51:56] [INFO] 迁移记录已添加: 104.248.191.16
[2025-11-21 15:51:56] [INFO] ============================================================
[2025-11-21 15:51:56] [INFO] 🎉 迁移流程全部完成！
[2025-11-21 15:51:56] [INFO] ============================================================
[2025-11-21 15:51:56] [INFO] 源服务器IP: 170.64.226.135
[2025-11-21 15:51:56] [INFO] 目标服务器IP: 104.248.191.16
[2025-11-21 15:51:56] [INFO] 迁移开始时间: 2025-11-21 15:43:48
[2025-11-21 15:51:56] [INFO] 迁移结束时间: 2025-11-21 15:51:56
[2025-11-21 15:51:56] [INFO] 总耗时: 488.44秒 (8.1分钟)
[2025-11-21 15:51:56] [INFO] 迁移日志已保存: /root/hermit_crab/logs/migrations/migration_20251121_154345.log
[2025-11-21 15:51:56] [INFO] ============================================================
