# Hermit Crab Configuration File
# 寄居蟹自动迁移系统配置

# 基本配置
base:
  # 项目安装路径
  install_path: "/root/hermit_crab"
  # 日志级别: DEBUG, INFO, WARNING, ERROR
  log_level: "INFO"
  # 当前服务器域名（需要在迁移前配置）
  current_domain: "a.ssfxx.com"

# GitHub 配置 - 用于中心化管理服务器列表
github:
  enabled: true
  # GitHub仓库 (格式: username/repo)
  repo: "your-username/hermit-nodes"
  # GitHub Token (从环境变量读取)
  token_env: "HERMIT_GITHUB_TOKEN"
  # nodes.json文件在仓库中的路径
  nodes_file: "nodes.json"
  # 本地缓存路径
  local_cache: "/opt/hermit_crab/data/nodes.json"

# CloudFlare DNS 配置
cloudflare:
  enabled: true
  # Zone ID
  zone_id: "your_zone_id"
  # API Token (从环境变量读取)
  api_token_env: "HERMIT_CF_TOKEN"
  # 域名后缀
  domain: "ssfxx.com"
  # DNS记录TTL（秒）
  ttl: 120

# 服务器生命周期配置
lifecycle:
  # 服务器总生命周期（天）
  total_days: 15
  # 触发迁移的剩余天数阈值
  migrate_threshold_days: 5
  # 目标服务器至少要比当前服务器多多少天
  minimum_gain_days: 1
  # 检查间隔（秒），默认每小时检查一次
  check_interval: 3600

# Rsync 配置
rsync:
  # 带宽限制 (KB/s)，0表示不限制
  bandwidth_limit: 0
  # 超时时间（秒）
  timeout: 7200
  # 排除列表文件
  exclude_file: "/opt/hermit_crab/config/exclude_list.txt"
  # 额外的rsync参数
  extra_args: "-aAXvzP --delete --numeric-ids"

# 迁移配置
migration:
  # SSH连接超时（秒）
  ssh_timeout: 30
  # 最大重试次数
  max_retries: 3
  # 重试间隔（秒）
  retry_interval: 300
  # 使用tar stream优化的目录列表
  tar_stream_dirs:
    - "/opt/projects"
    - "/var/www"
  # 数据库备份配置
  databases:
    mysql:
      enabled: false
      dump_path: "/tmp/mysql_dump.sql"
    redis:
      enabled: false
      dump_path: "/tmp/redis_dump.rdb"

# 反馈与健康检查
feedback:
  # 新服务器启动后等待时间（秒）
  startup_wait: 120
  # 反馈重试次数
  max_retry: 10
  # 反馈重试间隔（秒）
  retry_interval: 300
  # 健康检查端口
  health_check_port: 8888

# 通知配置（可选）
notification:
  enabled: false
  # 支持的通知方式：email, webhook, telegram
  methods:
    - "webhook"
  webhook:
    url: "https://your-webhook-url.com/notify"
    
# 安全配置
security:
  # SSH密钥路径
  ssh_key_path: "/root/.ssh/hermit_crab_id_rsa"
  # SSH用户名
  ssh_user: "root"
  # 临时密码使用（首次连接）
  use_password: true

# 调试模式
debug:
  # 是否启用调试模式
  enabled: false
  # 调试模式下是否真正执行迁移
  dry_run: false
  # 是否跳过重启
  skip_reboot: false

